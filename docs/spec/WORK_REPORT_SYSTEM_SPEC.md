# 業務委託 作業報告システム 仕様書（Cursor実装用）

---

## 1. 目的

本仕様書は、業務委託者の作業実態を可視化し、品質管理・報酬管理・説明責任を担保するための「作業報告システム」の実装指針を定めるものである。

本システムは、MISOGI基盤上での運用を前提とし、将来的な多職種・多拠点展開にも対応可能な構造とする。

---

## 2. 基本方針

* すべての業務は報告を前提とする
* 承認された報告のみ報酬対象とする
* 証跡（写真・時間）を必須とする
* 属人管理を排し、制度管理とする
* 後追い監査可能なログ構造とする

---

## 3. 対象ユーザー

| 区分    | 権限    | 主な操作        |
| ----- | ----- | ----------- |
| 業務委託者 | 作業者   | 入力・提出・修正    |
| 管理者   | 管理側   | 確認・承認・差戻・却下 |
| 管理責任者 | 管理責任者 | 確定・集計・支払管理  |

---

## 4. データ構造

### 4.1 WorkReport テーブル

| 項目名              | 型        | 必須 | 説明         |
| ---------------- | -------- | -- | ---------- |
| report_id        | UUID     | ○  | レポートID     |
| worker_id        | UUID     | ○  | 業務委託者ID    |
| contract_id      | UUID     | ○  | 契約ID       |
| project_id       | UUID     | ○  | 案件ID       |
| work_date        | date     | ○  | 作業日        |
| start_time       | time     | ○  | 開始時刻       |
| end_time         | time     | ○  | 終了時刻       |
| break_minutes    | int      | ○  | 休憩時間       |
| total_minutes    | int      | ○  | 実働時間       |
| work_type        | enum     | ○  | 定期/スポット/臨時 |
| task_contents    | text     | ○  | 作業内容       |
| problem_note     | text     |    | 異常・問題      |
| improvement_note | text     |    | 改善提案       |
| before_photos    | json     | ○  | 作業前写真      |
| after_photos     | json     | ○  | 作業後写真      |
| gps_location     | json     |    | 位置情報       |
| status           | enum     | ○  | 状態         |
| submitted_at     | datetime |    | 提出日時       |
| admin_comment    | text     |    | 管理コメント     |
| created_at       | datetime | ○  | 作成日時       |
| updated_at       | datetime | ○  | 更新日時       |

---

## 5. ステータス管理

### 5.1 状態定義

| ステータス | 値         | 説明    |
| ----- | --------- | ----- |
| 下書き   | draft     | 未提出   |
| 提出済   | submitted | 提出完了  |
| 確認中   | reviewing | 管理確認中 |
| 差戻し   | returned  | 修正依頼  |
| 承認済   | approved  | 承認済   |
| 確定    | fixed     | 支払対象  |
| 却下    | rejected  | 無効    |

---

### 5.2 遷移ルール

```
draft → submitted → reviewing → approved → fixed
              ↓
           returned → draft
              ↓
           rejected
```

* approved 以降は作業者による編集不可
* fixed は管理責任者のみ設定可能

---

## 6. 画面仕様

### 6.1 作業者画面

#### 機能

* 作業一覧表示
* 新規作業報告作成
* 下書き保存
* 写真アップロード
* 提出処理
* ステータス確認
* 差戻対応

#### 画面遷移

```
ログイン → 案件一覧 → 入力 → 保存 → 提出 → 状態確認
```

---

### 6.2 管理者画面

#### 機能

* 未確認一覧
* 詳細確認
* 承認/差戻/却下
* コメント入力
* 履歴閲覧

#### 画面遷移

```
管理TOP → 未確認一覧 → 詳細 → 処理 → 履歴
```

---

## 7. 業務フロー

```
① 作業実施
② 報告作成
③ 提出
④ 管理確認
⑤ 承認
⑥ 確定
⑦ 月次集計
⑧ 支払処理
```

* ⑤を通過しない報告は支払対象外

---

## 8. バリデーション仕様

| 項目   | 内容               |
| ---- | ---------------- |
| 時間   | 開始＜終了必須          |
| 写真   | before/after最低1枚 |
| 作業内容 | 空欄不可             |
| 重複   | 同一日時の重複防止        |
| 位置   | 任意（将来必須化可）       |

---

## 9. 権限制御

| 操作 | 作業者     | 管理者 | 管理責任者 |
| -- | ------- | --- | ----- |
| 作成 | ○       | ×   | ×     |
| 編集 | draftのみ | ×   | ×     |
| 提出 | ○       | ×   | ×     |
| 承認 | ×       | ○   | ○     |
| 確定 | ×       | ×   | ○     |
| 却下 | ×       | ○   | ○     |

---

## 10. ログ・監査

* 全操作履歴を audit_log に記録
* 変更前後の値を保存
* IP/UserAgent保存
* 3年間保存

---

## 11. API設計（例）

### 作業報告

| Method | Path                       | 説明   |
| ------ | -------------------------- | ---- |
| POST   | /work-reports              | 新規作成 |
| PUT    | /work-reports/{id}         | 更新   |
| POST   | /work-reports/{id}/submit  | 提出   |
| POST   | /work-reports/{id}/approve | 承認   |
| POST   | /work-reports/{id}/return  | 差戻   |
| POST   | /work-reports/{id}/reject  | 却下   |
| POST   | /work-reports/{id}/fix     | 確定   |

---

## 12. 非機能要件

* SLA: 99.9%
* 同時接続: 1000人想定
* レスポンス: 1秒以内
* 写真保存: S3
* バックアップ: 日次

---

## 13. 将来拡張

* AIによる異常検知
* 自動評価スコア
* 契約連動型報酬計算
* 外部会計連携
* 多職種テンプレ化

---

## 14. 運用ルール

* 未提出3回で指導
* 却下2回で契約見直し
* 虚偽報告は即契約停止対象

---

以上
