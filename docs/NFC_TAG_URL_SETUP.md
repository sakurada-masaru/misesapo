# NFCタグ打刻システム - URL方式セットアップガイド

## 概要

NFCタグにURLを書き込むことで、物理的にその場所にいることを証明する打刻システムです。

## 仕組み

1. **NFCタグにURLを書き込む**
   - 各店舗のNFCタグに、その場所専用のURLを書き込む
   - 例: `https://your-web-app.com/staff/nfc-clock-in?facility_id=ABC_001&location_id=TK_R01_TOILET_IN`

2. **iPhoneでNFCタグを読み取る**
   - iPhoneをNFCタグに近づけると、自動的にSafariでURLが開く（iOS標準機能）
   - 追加アプリ不要

3. **自動的に打刻**
   - 開いたWebページが自動的にAPIを呼び出して打刻
   - ログインユーザーのIDと、URLパラメータから取得した施設ID・場所IDを送信

## セキュリティの利点

- **物理的な近接が必要**: NFCタグは数cm以内に近づかないと読み取れない
- **場所の証明**: その場所のNFCタグからしか読み取れないURL
- **写真では持ち運べない**: QRコードと違い、NFCタグは写真を撮っても意味がない

## セットアップ手順

### 1. NFCタグの準備

各店舗の各場所にNFCタグを用意します。

**必要な情報:**
- 施設ID（例: `ABC_001`）
- 場所ID（例: `TK_R01_TOILET_IN`）

### 2. URLの生成

各NFCタグ用のURLを生成します：

```
https://your-web-app.com/staff/nfc-clock-in?facility_id=ABC_001&location_id=TK_R01_TOILET_IN
```

**URLの形式:**
- ベースURL: `https://your-web-app.com/staff/nfc-clock-in`
- パラメータ:
  - `facility_id`: 施設ID
  - `location_id`: 場所ID

### 3. NFCタグにURLを書き込む

**使用アプリ:**
- NFC Tools（推奨）
- NFC Writer Tool
- その他のNFC書き込みアプリ

**手順:**
1. NFC Toolsアプリを開く
2. 「書き込み」タブを選択
3. 「URL」を選択
4. 生成したURLを入力
5. NFCタグにiPhoneを近づけて書き込み

### 4. NFCタグの設置

各店舗の各場所にNFCタグを貼り付けます。

**設置場所の例:**
- トイレ入口: `TK_R01_TOILET_IN`
- トイレ出口: `TK_R01_TOILET_OUT`
- エントランス: `ENTRANCE_MAIN`
- など

## 使用方法

### 清掃員の操作

1. iPhoneでNFCタグに近づける
2. 自動的にSafariが開く
3. 自動的に打刻が実行される
4. 成功メッセージが表示される

**注意:**
- ログインしている必要があります
- インターネット接続が必要です

## URL一覧の管理

各店舗・各場所のURLを管理することを推奨します。

**管理方法:**
- スプレッドシートで管理
- データベースで管理

**管理項目:**
- 施設ID
- 場所ID
- 場所名
- URL
- 設置日
- 設置場所の説明

## トラブルシューティング

### NFCタグが読み取れない

- iPhoneをNFCタグに近づける（数cm以内）
- NFCタグが正しく書き込まれているか確認
- NFCタグが破損していないか確認

### URLが開かない

- インターネット接続を確認
- URLが正しく書き込まれているか確認
- Safariの設定を確認

### 打刻が失敗する

- ログインしているか確認
- インターネット接続を確認
- ブラウザのコンソールでエラーを確認

## セキュリティ考慮事項

### 推奨事項

1. **HTTPSを使用**: URLは必ずHTTPSを使用
2. **認証必須**: ログインしていない場合は打刻を拒否
3. **URLの難読化**: 必要に応じて、URLパラメータを暗号化
4. **ログの記録**: 打刻ログを記録して監査可能にする

### 注意事項

- URLが推測されやすい場合は、追加の認証を検討
- 打刻の重複を防ぐ仕組みを実装（既に実装済み）

## コスト

- **NFCタグ**: 1枚あたり50円〜200円程度
- **NFC書き込みアプリ**: 無料〜数百円
- **開発コスト**: 既存Webアプリの拡張のみ（ほぼゼロ）

## まとめ

この方式により、以下のメリットが得られます：

1. ✅ **物理的な場所の証明**: NFCタグは物理的にその場所にいないと読み取れない
2. ✅ **ネイティブアプリ不要**: Webアプリで完結
3. ✅ **低コスト**: NFCタグとアプリのみ
4. ✅ **簡単な運用**: URLを書き込むだけ

