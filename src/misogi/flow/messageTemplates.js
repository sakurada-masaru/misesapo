export const MESSAGE_TEMPLATES = {
      // 悪天候
      weather: {
            title: "悪天候対応（安全最優先）",
            base: `
  大変な状況ですね。
  現在、悪天候および路面状況の悪化により、業務に支障が出る可能性があります。
  `,
            guide: `
  【現場判断】
  安全を最優先してください。無理な現場入りは不要です。
  続行が難しい場合は、直ちに報告してください。
  
  【営業対応】
  顧客連絡は原則、営業が行います。
  深夜帯などで連絡がつかない場合のみ、現場から一次連絡を入れてください。
  
  【OP調整】
  OPは平日09:00以降に、リスケジュール協議のみを担当します。
  `,
            reassurance: `
  無理する必要はありません。
  状況は管理側にも共有されます。焦らず安全確保をお願いします。
  `,
            customer_template: `
  「悪天候のため、本日の作業が難しい状況です。
  後ほど改めて営業担当からご連絡します」
  とお伝えください。
  `,
      },

      // 人員不足
      staff: {
            title: "人員不足対応",
            base: `
  現在、人員の確保が難しい状況です。
  `,
            guide: `
  【現場判断】
  現状の人員で作業が可能か判断し、無理なら待機してください。
  
  【営業対応】
  顧客への事情説明・謝罪は営業が行います。
  
  【OP調整】
  OPは平日09:00以降に、日程変更（リスケジュール）協議のみを進めます。
  `,
            reassurance: `
  現場で抱え込まず、必ず共有してください。
  組織として対応します。
  `,
      },

      // 入室不可（鍵など）
      entry: {
            title: "入室不可対応",
            base: `
  現在、入室条件が未確定、または入室できない状況です。
  `,
            guide: `
  【現場判断】
  鍵・入室方法を再確認してください。
  入れない場合は、最大15分程度待機した後、再度報告してください。
  
  【営業対応】
  鍵担当者や店舗責任者への連絡は営業が行います。
  （深夜帯は現場からの一報をお願いする場合があります）
  
  【OP調整】
  OPは平日09:00以降に、リスケジュール協議のみを行います。
  `,
            reassurance: `
  現場で無理に対応する必要はありません。
  こちらで調整します。
  `,
      },

      // 遅延
      late: {
            title: "遅延対応",
            base: `
  現在、到着または作業開始に遅延が発生しています。
  `,
            guide: `
  【現場判断】
  到着見込み時間を算出し、安全な範囲で急行してください。
  
  【営業対応】
  顧客への遅延連絡は原則営業が行います。
  ただし、到着直前や深夜帯は現場から一報入れる方がスムーズな場合があります。
  
  【OP調整】
  OPは平日09:00以降に、リスケジュール協議のみを行います。
  `,
            reassurance: `
  焦らず、事故のないよう安全運転を優先してください。
  顧客対応はこちらで引き継ぎます。
  `,
      },

      // クレーム・再清掃
      complaint: {
            title: "再清掃／クレーム対応",
            base: `
  お客様から確認・指摘が入っています。
  `,
            guide: `
  【現場判断】
  指摘内容を確認し、事実関係を整理してください。
  その場で安易な約束はせず、「持ち帰って確認します」としてください。
  
  【営業対応】
  顧客対応・折衝は営業が一本化して行います。
  
  【OP調整】
  OPは平日09:00以降に、是正清掃のリスケジュール協議のみを行います。
  `,
            reassurance: `
  個人の責任ではありません。
  組織として誠実に対応します。
  `,
      },

      // 未入金
      payment: {
            title: "未入金対応",
            base: `
  入金が確認できていない状況です。
  `,
            guide: `
  【現場判断】
  現場での対応は不要です。作業に集中してください。
  
  【営業・経理対応】
  催告および再請求は営業・管理側で行います。
  
  【OP調整】
  OPは平日09:00以降に、リスケジュール協議のみを行います。
  `,
            reassurance: `
  現場で金銭の話をする必要はありません。
  全てこちらで処理します。
  `,
      },

      // 連絡がつかない
      contact: {
            title: "連絡不通時の対応",
            base: `
  相手方と連絡がつかない状況ですね。
  `,
            guide: `
  【現場判断】
  何度か連絡を試み、繋がらなければ報告してください。
  
  【営業対応】
  営業ルートで緊急連絡先へ確認を取ります。
  
  【OP調整】
  OPは平日09:00以降に、待機解除後のリスケジュール協議のみを行います。
  `,
            reassurance: `
  現場の責任ではありません。
  無理に待機し続ける必要はありません。
  `,
      },

      // 資材不足・機材不良
      material: {
            title: "資材・機材トラブル対応",
            base: `
  作業に必要な資材や機材に問題が発生しています。
  `,
            guide: `
  【現場判断】
  「継続」「部分実施」「中断」の一次判断を行い、写真を送ってください。
  
  【営業対応】
  品質に関わる場合は、営業から顧客へ説明します。
  
  【OP調整】
  OPは平日09:00以降に、後日対応のリスケジュール協議のみを行います。
  `,
            reassurance: `
  無理に進めて隠すより、正直な報告が信頼に繋がります。
  代替案を一緒に考えましょう。
  `,
      },

      // 事故・破損・怪我
      incident: {
            title: "事故・破損・怪我対応",
            base: `
  緊急事態が発生しています。
  まず、あなた自身の安全と、周囲の安全を確保してください。
  `,
            guide: `
  【現場判断】
  怪我人の救護が最優先です。
  物損は現場保全（そのままにする/写真を撮る）を行ってください。
  
  【営業・管理対応】
  直ちに報告してください。会社として全責任を持って対応します。
  現場では謝罪のみ行い、弁償等の約束は一切しないでください。
  
  【OP調整】
  OPは平日09:00以降に、延期のリスケジュール協議のみを行います。
  `,
            reassurance: `
  大丈夫です。会社が守ります。
  あなたは状況報告だけしてください。一人で抱え込まないでください。
  `,
      },

      // システム障害
      system: {
            title: "システム障害対応",
            base: `
  現在、業務システムに不具合が発生しています。
  `,
            guide: `
  【現場判断】
  本日はLINEでのテキスト報告で代用してください。
  
  【管理対応】
  システム担当が復旧作業にあたります。
  
  【OP調整】
  OPは平日09:00以降に、日程変更が必要な場合のリスケジュール協議のみを行います。
  `,
            reassurance: `
  ご不便をおかけして申し訳ありません。
  こちらの不手際ですので、現場の評価には影響しません。
  `,
      },

      // 無断欠勤
      no_show: {
            title: "作業員不在対応",
            base: `
    予定されていた作業員が現場にいません。
    `,
            guide: `
    【現場・発見者判断】
    直ちに報告してください。
    
    【営業対応】
    顧客へ状況を説明し、謝罪と今後の対応を伝えます。
    
    【OP調整】
    OPは平日09:00以降に、リスケジュール協議のみを行います。
    `,
            reassurance: `
    この状況は現場の責任ではありません。
    速やかに次の手を打ちます。
    `,
      },

      // デフォルト（通常）
      default: {
            title: "通常進行",
            base: "順調ですね。",
            guide: `
    【現場判断】
    安全第一で作業を進めてください。
    
    【営業・OP】
    特に介入事項はありません。
        `,
            reassurance: "いつもありがとうございます。",
      }
};

export function buildMessage(rule) {
      const key = rule?.messageKey;
      const t = MESSAGE_TEMPLATES[key] || MESSAGE_TEMPLATES.default;

      return {
            title: t.title,
            text: `
${t.base.trim()}

${t.guide.trim()}

${t.reassurance.trim()}
`.trim(),
            customer_template: t.customer_template || null
      };
}
