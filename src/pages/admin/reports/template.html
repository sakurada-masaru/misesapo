@layout('layouts.admin')
@json('data/meta/admin_reports_template_title.json', $title)
@json('data/meta/admin_reports_template_body_class.json', $body_class)

<style>
    /* Hide default headers */
    #default-header-wrapper,
    #normal-header-wrapper {
        display: none !important;
    }

    .site-footer {
        display: none !important;
    }

    /* Page Layout */
    .report-template-page {
        display: flex;
        min-height: 100vh;
    }

    .template-main {
        flex: 1;
        background: #f1f5f9;
        padding: 0;
    }

    /* Fixed Header */
    .template-header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
        color: white;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .template-header .back-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s;
    }

    .template-header .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .template-header h1 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        flex: 1;
    }

    .template-header .haccp-badge {
        background: #10b981;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.5px;
    }

    /* Tabs Navigation */
    .cleaning-tabs {
        display: flex;
        background: white;
        border-bottom: 1px solid #e2e8f0;
        overflow-x: auto;
        padding: 0 24px;
    }

    .cleaning-tab {
        padding: 14px 20px;
        border: none;
        background: transparent;
        font-size: 0.9rem;
        font-weight: 600;
        color: #64748b;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
        transition: all 0.2s;
    }

    .cleaning-tab:hover {
        color: #1e3a5f;
        background: #f8fafc;
    }

    .cleaning-tab.active {
        color: #1e3a5f;
        border-bottom-color: #ec4899;
    }

    /* Report Content Area */
    .report-content-area {
        padding: 24px;
        max-width: 900px;
        margin: 0 auto;
    }

    /* HACCP Header Card */
    .haccp-header-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .haccp-header-card .card-title {
        background: linear-gradient(135deg, #1e3a5f 0%, #334155 100%);
        color: white;
        padding: 12px 20px;
        font-size: 0.9rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .haccp-header-card .card-body {
        padding: 20px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .info-label {
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
        padding: 8px 12px;
        background: #f8fafc;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
    }

    /* Photo Comparison Section */
    .photo-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .photo-section-header {
        background: #fdf2f8;
        padding: 12px 20px;
        border-bottom: 1px solid #fce7f3;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .photo-section-title {
        font-size: 1rem;
        font-weight: 700;
        color: #be185d;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .photo-comparison {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 0;
        padding: 20px;
        align-items: stretch;
    }

    .photo-box {
        background: #f8fafc;
        border: 2px dashed #cbd5e1;
        border-radius: 8px;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .photo-box.has-image {
        border-style: solid;
        border-color: #e2e8f0;
    }

    .photo-label-bar {
        padding: 8px 12px;
        font-size: 0.8rem;
        font-weight: 700;
        text-align: center;
    }

    .photo-box.before .photo-label-bar {
        background: #fef3c7;
        color: #92400e;
    }

    .photo-box.after .photo-label-bar {
        background: #d1fae5;
        color: #065f46;
    }

    .photo-placeholder {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        gap: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .photo-placeholder:hover {
        background: #f1f5f9;
        color: #64748b;
    }

    .photo-placeholder i {
        font-size: 2rem;
    }

    .photo-placeholder span {
        font-size: 0.85rem;
    }

    .photo-image {
        flex: 1;
        width: 100%;
        object-fit: cover;
    }

    .photo-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #ec4899;
        padding: 0 16px;
    }

    /* Work Details Card */
    .work-details-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        margin-bottom: 20px;
    }

    .work-details-header {
        padding: 12px 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        color: #1e293b;
    }

    .work-details-body {
        padding: 20px;
    }

    .detail-row {
        display: grid;
        grid-template-columns: 140px 1fr;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-label {
        font-size: 0.85rem;
        font-weight: 700;
        color: #64748b;
    }

    .detail-value {
        font-size: 0.95rem;
        color: #1e293b;
    }

    .detail-value.editable {
        padding: 8px 12px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        min-height: 40px;
    }

    /* Status Chips */
    .status-chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .status-chip {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s;
    }

    .status-chip.normal {
        background: #d1fae5;
        color: #065f46;
    }

    .status-chip.abnormal {
        background: #fecaca;
        color: #991b1b;
    }

    .status-chip.selected {
        border-color: #1e3a5f;
        box-shadow: 0 0 0 2px rgba(30, 58, 95, 0.2);
    }

    /* Signature Section */
    .signature-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    .signature-box {
        text-align: center;
    }

    .signature-box-title {
        font-size: 0.85rem;
        font-weight: 700;
        color: #64748b;
        margin-bottom: 8px;
    }

    .signature-area {
        height: 80px;
        border: 2px solid #1e3a5f;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        font-size: 0.8rem;
    }

    /* Footer Actions */
    .template-footer {
        position: sticky;
        bottom: 0;
        background: white;
        border-top: 1px solid #e2e8f0;
        padding: 16px 24px;
        display: flex;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
    }

    .btn-action {
        padding: 12px 32px;
        border-radius: 8px;
        font-size: 0.95rem;
        font-weight: 700;
        cursor: pointer;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
    }

    .btn-secondary {
        background: #f1f5f9;
        color: #475569;
        border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover {
        background: #e2e8f0;
    }

    /* Print Styles */
    @media print {

        .template-header,
        .cleaning-tabs,
        .template-footer {
            display: none !important;
        }

        .photo-placeholder {
            display: none;
        }

        .report-content-area {
            padding: 0;
            max-width: 100%;
        }
    }
</style>

<main class="report-template-page">
    @include('partials.admin-sidebar')

    <div class="template-main">
        <!-- Header -->
        <div class="template-header">
            <a href="/admin/reports" class="back-btn">
                <i class="fas fa-chevron-left"></i>
            </a>
            <h1><i class="fas fa-file-medical-alt"></i> HACCP清掃実施報告書</h1>
            <span class="haccp-badge">HACCP準拠</span>
        </div>

        <!-- Cleaning Item Tabs -->
        <div class="cleaning-tabs" id="cleaning-tabs">
            <button class="cleaning-tab active" data-tab="exhaust">換気扇・ダクト</button>
            <button class="cleaning-tab" data-tab="grease">グリストラップ</button>
            <button class="cleaning-tab" data-tab="floor">床面清掃</button>
            <button class="cleaning-tab" data-tab="equipment">厨房機器</button>
            <button class="cleaning-tab" data-tab="other">その他</button>
        </div>

        <!-- Report Content -->
        <div class="report-content-area">
            <!-- HACCP基本情報 -->
            <div class="haccp-header-card">
                <div class="card-title">
                    <i class="fas fa-clipboard-check"></i>
                    HACCP 清掃実施記録（様式1-3）
                </div>
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">実施日</span>
                            <div class="info-value" id="report-date">2026年1月9日</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">店舗名</span>
                            <div class="info-value" id="report-store">{{店舗名}}</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ブランド</span>
                            <div class="info-value" id="report-brand">{{ブランド名}}</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">作業者</span>
                            <div class="info-value" id="report-worker">{{作業者名}}</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">開始時刻</span>
                            <div class="info-value" id="report-start">--:--</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">終了時刻</span>
                            <div class="info-value" id="report-end">--:--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 写真比較セクション -->
            <div class="photo-section">
                <div class="photo-section-header">
                    <div class="photo-section-title">
                        <i class="fas fa-images"></i>
                        作業写真記録
                    </div>
                    <span style="font-size: 0.8rem; color: #64748b;">ビフォー・アフター比較</span>
                </div>
                <div class="photo-comparison">
                    <div class="photo-box before">
                        <div class="photo-label-bar">作業前 (BEFORE)</div>
                        <div class="photo-placeholder" id="before-photo-slot">
                            <i class="fas fa-camera"></i>
                            <span>写真をドロップまたはクリック</span>
                        </div>
                    </div>
                    <div class="photo-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="photo-box after">
                        <div class="photo-label-bar">作業後 (AFTER)</div>
                        <div class="photo-placeholder" id="after-photo-slot">
                            <i class="fas fa-camera"></i>
                            <span>写真をドロップまたはクリック</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 作業詳細 -->
            <div class="work-details-card">
                <div class="work-details-header">
                    <i class="fas fa-tasks"></i>
                    作業内容・確認事項
                </div>
                <div class="work-details-body">
                    <div class="detail-row">
                        <div class="detail-label">作業区分</div>
                        <div class="detail-value">
                            <div class="status-chips">
                                <span class="status-chip normal selected">定期清掃</span>
                                <span class="status-chip">臨時清掃</span>
                                <span class="status-chip">是正対応</span>
                            </div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">清掃対象</div>
                        <div class="detail-value" id="cleaning-target">換気扇・ダクト内部</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">実施内容</div>
                        <div class="detail-value editable" id="work-description" contenteditable="true">
                            フィルター取り外し → 専用洗剤による洗浄 → 高圧洗浄 → 乾燥 → 再取付
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">確認結果</div>
                        <div class="detail-value">
                            <div class="status-chips">
                                <span class="status-chip normal selected">異常なし</span>
                                <span class="status-chip abnormal">要是正</span>
                            </div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">備考・所見</div>
                        <div class="detail-value editable" id="work-notes" contenteditable="true">
                            {{MISOGIが自動生成するコメント}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 確認印欄 -->
            <div class="signature-section">
                <div class="signature-box">
                    <div class="signature-box-title">作業責任者</div>
                    <div class="signature-area">印</div>
                </div>
                <div class="signature-box">
                    <div class="signature-box-title">店舗確認者</div>
                    <div class="signature-area">印</div>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="template-footer">
            <button class="btn-action btn-secondary">
                <i class="fas fa-save"></i> 下書き保存
            </button>
            <button class="btn-action btn-primary" id="btn-generate-pdf">
                <i class="fas fa-file-pdf"></i> PDF出力
            </button>
        </div>
    </div>
</main>

<script>
    // Tab switching
    document.querySelectorAll('.cleaning-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.cleaning-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            // TODO: Load content for selected tab
        });
    });

    // Status chip selection
    document.querySelectorAll('.status-chips').forEach(group => {
        group.querySelectorAll('.status-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                group.querySelectorAll('.status-chip').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
            });
        });
    });

    // PDF Generation
    document.getElementById('btn-generate-pdf')?.addEventListener('click', () => {
        window.print();
    });
</script>