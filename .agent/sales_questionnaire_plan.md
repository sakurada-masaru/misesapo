# 営業問診票システム設計書

## 概要

営業担当者が現地訪問時に使用する問診票（ヒアリングシート）を、AIによる写真判定とスコアリング機能を搭載したシステムとして再構築する。

### 目的
1. 現地の清掃状態を客観的にスコア化
2. 写真・動画データを店舗ごとに蓄積
3. 24ヶ月の定期契約サイクルに対応したデータ管理
4. 営業提案・清掃品質管理・顧客レポートに活用

---

## システム構成

### 入力方式：ハイブリッド型

カテゴリ選択型と会話型を組み合わせた入力方式を採用。

#### フロー
1. **カテゴリ選択**（タップで選ぶ）
   - 基本ヒアリング
   - 店舗仕様
   - 設備・内装
   - 注意事項・計画
   - 📷 写真撮影

2. **会話型入力**（選んだカテゴリ内で）
   - MISOGIが一問一答形式で質問
   - 音声入力またはテキスト入力
   - 入力後に確認・修正ステップ

3. **写真撮影 + AI判定**
   - カテゴリ別に撮影ガイド
   - AIがスコアと問題点を自動判定
   - 営業マンが確認・微調整

#### 音声入力の運用
- Web Speech API（ブラウザ標準）を使用
- 音声認識結果は必ずテキスト表示
- ユーザーが確認・修正してから確定
- 専門用語の誤認識に対応

---

## AIスコアリング機能

### 評価カテゴリと配点

| カテゴリ | 評価項目 | 配点 |
|----------|----------|------|
| 厨房 | 油汚れ、床、排水溝、レンジフード | 25点 |
| 客席 | テーブル、椅子、床、壁 | 20点 |
| トイレ | 便器、床、洗面台、臭気 | 20点 |
| 空調 | フィルター、本体、ダクト | 15点 |
| 外観 | 入口、看板、窓ガラス | 10点 |
| その他 | 総合的な印象 | 10点 |
| **合計** | | **100点** |

### AI判定リクエスト例

```json
{
  "images": [
    { "category": "kitchen", "image": "base64..." },
    { "category": "floor", "image": "base64..." },
    { "category": "toilet", "image": "base64..." }
  ],
  "prompt": "飲食店の清掃状態を査定してください。各画像について以下を判定：カテゴリ別スコア（0-100）、問題点の詳細、改善推奨事項、優先度（高/中/低）"
}
```

### AI判定レスポンス例

```json
{
  "total_score": 42,
  "categories": {
    "kitchen": {
      "score": 35,
      "issues": ["レンジフード油固着", "床の油膜"],
      "priority": "高"
    },
    "toilet": {
      "score": 60,
      "issues": ["水垢", "換気扇埃"],
      "priority": "中"
    }
  },
  "recommendations": [
    "レンジフード分解洗浄を推奨",
    "床のワックス剥離清掃が必要"
  ]
}
```

### 撮影ガイド

| 撮影対象 | ガイドメッセージ |
|----------|-----------------|
| 厨房全体 | 「厨房全体が写るように撮影してください」 |
| レンジフード | 「レンジフードを正面から撮影してください」 |
| 床 | 「床を斜め上から撮影してください」 |
| 客席エリア | 「客席全体が見える位置から撮影してください」 |
| トイレ | 「トイレ内部を撮影してください」 |
| ブレーカー | 「ブレーカーの位置がわかるように撮影してください」 |

---

## データ蓄積構造

### S3 ストレージ構成

```
s3://misesapo-media/
├── stores/
│   ├── STORE-001/
│   │   ├── surveys/           # 問診票データ
│   │   │   ├── 2026-01-13/
│   │   │   │   ├── kitchen_01.jpg
│   │   │   │   ├── kitchen_02.jpg
│   │   │   │   ├── toilet_01.jpg
│   │   │   │   └── metadata.json
│   │   │   └── 2026-04-15/
│   │   │       └── ...
│   │   ├── reports/           # 清掃レポート
│   │   │   └── 2026-01-15/
│   │   │       ├── before_01.jpg
│   │   │       ├── after_01.jpg
│   │   │       └── timelapse.mp4
│   │   └── archive/           # アーカイブ
│   │       └── (古いデータを圧縮保存)
│   └── STORE-002/
│       └── ...
```

### DynamoDB テーブル設計

#### メインテーブル: misesapo-store-media

```json
{
  "PK": "STORE#STORE-001",
  "SK": "SURVEY#2026-01-13#001",
  "type": "survey",
  "date": "2026-01-13",
  "score": 42,
  "category": "initial",
  "photos": [
    { "key": "kitchen_01.jpg", "s3_tier": "standard" }
  ],
  "issues": ["レンジフード油固着", "床の油膜"],
  "recommendations": ["分解洗浄推奨"],
  "created_by": "yoshida@misesapo.co.jp"
}
```

#### 集計テーブル: misesapo-store-analytics

```json
{
  "PK": "STORE#STORE-001",
  "SK": "MONTHLY#2026-01",
  "avg_score": 78,
  "cleaning_count": 2,
  "photo_count": 25,
  "highlights": ["スコア85達成", "厨房清掃完了"]
}
```

---

## 24ヶ月長期運用設計

### 1店舗あたりの24ヶ月間データ量

| データ種別 | 頻度 | 24ヶ月間 | 容量 |
|-----------|------|----------|------|
| 問診票写真 | 初回 + 更新4回 | 約50枚 | 150MB |
| 清掃レポート | 月2回 × 24 | 480枚 | 1.4GB |
| 動画 | 月1回 × 24 | 24本 | 1.2GB |
| メタデータ | 随時 | JSON | 1MB |
| **合計** | | | **約3GB** |

### S3 ライフサイクルポリシー

| 期間 | ストレージ階層 | 用途 | コスト |
|------|---------------|------|--------|
| 0-6ヶ月 | Standard | 即時アクセス、頻繁に参照 | $0.025/GB/月 |
| 6-12ヶ月 | Intelligent-Tiering | アクセス頻度で自動最適化 | $0.023/GB/月 |
| 12-24ヶ月 | Glacier Instant Retrieval | 長期保存、契約更新時の振り返り | $0.004/GB/月 |
| 24ヶ月以降 | Glacier Deep Archive | 法的保持・アーカイブ用 | $0.00099/GB/月 |

### コスト試算（100店舗の場合）

| 期間 | ストレージ階層 | 容量 | 月額コスト |
|------|---------------|------|-----------|
| 0-6ヶ月 | Standard | 75GB | $1.88 |
| 6-12ヶ月 | Intelligent | 75GB | $1.73 |
| 12-24ヶ月 | Glacier IR | 150GB | $0.60 |
| **合計** | | **300GB** | **$4.21/月** |

**年間コスト: 約$50 = 約7,500円 / 100店舗**

---

## データ活用シーン

### 1. 営業提案
- 初回訪問時のスコアと改善予測の提示
- 類似店舗の改善事例
- ビフォーアフター比較資料

### 2. 清掃品質管理
- 清掃後スコアの確認
- 問題箇所の優先順位付け
- 清掃員への具体的な指示

### 3. 顧客レポート
- 月次スコア推移レポート
- 写真付き作業報告
- 改善提案

### 4. 契約更新
- 24ヶ月間のサマリーレポート
- スコア推移グラフ
- 清掃効果の可視化

### 5. AI学習
- スコアリング精度の向上
- 汚れパターンの分類
- 自動推奨の改善

---

## 実装フェーズ

### Phase 1: 基本機能（工数: 約5時間）
1. 営業モードに「問診票」メニュー追加
2. カテゴリ選択UI
3. 会話型入力（音声ボタン付き）
4. 写真撮影 + S3アップロード
5. 確認・修正フロー
6. 保存・一時保存機能

### Phase 2: AIスコアリング（工数: 約3時間）
1. Lambda修正（Gemini Vision対応）
2. 写真解析とスコア算出
3. 解析結果を問診票に自動入力
4. 営業マンによる確認・修正

### Phase 3: データ蓄積・可視化（工数: 約4時間）
1. DynamoDBテーブル作成（misesapo-store-media, misesapo-store-analytics）
2. 店舗別スコア履歴の保存
3. スコア推移グラフ表示
4. 店舗メディアライブラリUI

### Phase 4: 長期運用対応（工数: 約2時間）
1. S3ライフサイクルポリシー設定
2. 24ヶ月サマリーレポート機能
3. 契約更新時のデータ引き継ぎ

---

## 技術スタック

| コンポーネント | 技術 |
|---------------|------|
| フロントエンド | HTML/CSS/JavaScript（営業MISOGI画面） |
| 音声入力 | Web Speech API |
| カメラ | HTML5 input[type=file][capture=environment] |
| 画像ストレージ | Amazon S3 + ライフサイクル管理 |
| メタデータDB | Amazon DynamoDB |
| AI画像解析 | Google Gemini Vision API |
| バックエンド | AWS Lambda + API Gateway |

---

## UI/UXイメージ

### 問診票入力画面

```
┌─────────────────────────────────────┐
│ 📋 問診票 > 晩杯屋 門前仲町店        │
├─────────────────────────────────────┤
│                                     │
│ [基本] [店舗] [設備] [注意] [📷写真] │
│                                     │
│ MISOGI: 「清掃の悩みを教えてください」│
│                                     │
│ [🎤 音声入力] [⌨️ テキスト入力]       │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 厨房の油が落ちない...           │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [✓ OK]  [✏️ 修正]                   │
│                                     │
│ [次のカテゴリへ] [一時保存して終了]   │
└─────────────────────────────────────┘
```

### 店舗メディアライブラリ

```
┌─────────────────────────────────────┐
│ 📁 店舗メディア > 晩杯屋 門前仲町店  │
├─────────────────────────────────────┤
│ [問診票] [清掃レポート] [動画] [全て] │
├─────────────────────────────────────┤
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐    │
│ │ 📸  │ │ 📸  │ │ 📸  │ │ 🎥  │    │
│ ├─────┤ ├─────┤ ├─────┤ ├─────┤    │
│ │01/13│ │01/20│ │04/15│ │01/20│    │
│ │35点 │ │85点 │ │78点 │ │清掃 │    │
│ └─────┘ └─────┘ └─────┘ └─────┘    │
│                                     │
│ 📈 スコア推移                       │
│ ┌─────────────────────────────────┐ │
│ │ 85●━━━━━━━●78                  │ │
│ │    ╱                            │ │
│ │●35                              │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 24ヶ月契約サマリー

```
┌─────────────────────────────────────────┐
│ 📊 契約期間サマリー                      │
│    晩杯屋 門前仲町店（2024/01 - 2025/12）│
├─────────────────────────────────────────┤
│                                         │
│ 【スコア推移】                          │
│  100 ┤                                  │
│   80 ┤      ●━━●━━●━━●━━●━━●━━●      │
│   60 ┤  ●━━●                           │
│   40 ┤●                                 │
│   20 ┤                                  │
│    0 ┼────────────────────────→         │
│     初回  3M  6M  9M  12M 15M 18M 21M 24M│
│                                         │
│ 【実績サマリー】                        │
│ ├─ 清掃回数: 48回                       │
│ ├─ 撮影写真: 532枚                      │
│ ├─ 動画記録: 24本                       │
│ ├─ スコア改善: +45点（35→80）           │
│ └─ 維持期間: 18ヶ月連続80点以上          │
│                                         │
│ [📥 PDFダウンロード] [🔄 次期契約へ]     │
└─────────────────────────────────────────┘
```

---

## まとめ

本システムにより以下を実現：

1. **客観的な品質評価** - AI写真判定によるスコアリング
2. **効率的な入力** - ハイブリッド型（カテゴリ選択 + 会話型 + 音声）
3. **長期データ蓄積** - 24ヶ月サイクルに対応したストレージ設計
4. **低コスト運用** - S3ライフサイクルによる自動最適化
5. **多角的な活用** - 営業提案、品質管理、顧客レポート、AI学習

---

*作成日: 2026-01-13*
*バージョン: 1.0*
